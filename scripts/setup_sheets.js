const { google } = require('googleapis');
require('dotenv').config({ path: '.env.local' });

// í™˜ê²½ë³€ìˆ˜ì—ì„œ ì„¤ì • ì½ê¸°
const SPREADSHEET_ID = '19BkUNdxQ8NksgrYsbLzID-Rv6B14R8TRdQ26E6uNhig';
const GOOGLE_SERVICE_ACCOUNT_EMAIL = process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL;
const GOOGLE_PRIVATE_KEY = process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g, '\n');

// ê° ì‹œíŠ¸ì˜ í—¤ë” ì •ì˜
const SHEET_HEADERS = {
  'í•™ìƒì •ë³´': ['ì´ë¦„', 'ë°˜', 'í•™êµ', 'ì—°ë½ì²˜'],
  'ì£¼ê°„ì„±ì ': ['ì´ë¦„', 'ë°˜', 'í•™êµ', 'ì£¼ì°¨', 'ë…í•´ë‹¨ì–´1', 'ë…í•´ë‹¨ì–´2', 'ë…í•´ë‹¨ì–´3', 'ë…í•´ë‹¨ì–´4', 'ë…í•´ë‹¨ì–´5', 'ë¬¸ë²•ì´ë¡ ', 'ë¬¸ë²•í™•ì¸í•™ìŠµ1', 'ë¬¸ë²•í™•ì¸í•™ìŠµ2', 'ë¬¸ë²•í™•ì¸í•™ìŠµ3', 'ë¬¸ë²•í™•ì¸í•™ìŠµ4', 'ëª¨ì˜ê³ ì‚¬', 'ë‚´ì‹ ê¸°ì¶œ', 'ìˆ™ì œ1', 'ìˆ™ì œ2'],
  'ë‚´ì‹ ê¸°ì¶œì„±ì ': ['ì´ë¦„', 'ë°˜', 'í•™êµ', 'ê¸°ê°„', 'ì‹œí—˜ìœ í˜•', 'ì‹œí—˜ëª…', 'ì–´íœ˜', 'ì–´ë²•', 'ë…í•´(ëŒ€ì˜)', 'ë…í•´(ì„¸ë¶€)', 'ë¹ˆì¹¸', 'ì„œë‹µí˜•', 'ì´ì ', 'ë§Œì '],
  'ì„¤ì •': ['ì„¤ì •í‚¤', 'ì„¤ì •ê°’']
};

// ìƒ˜í”Œ ë°ì´í„° (í…ŒìŠ¤íŠ¸ìš©)
const SAMPLE_DATA = {
  'í•™ìƒì •ë³´': [
    ['í™ê¸¸ë™', 'Aë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '010-1234-5678'],
    ['ê¹€ì² ìˆ˜', 'Aë°˜', 'ì„œìš¸ê³ ë“±í•™êµ', '010-2345-6789'],
    ['ì´ì˜í¬', 'Bë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '010-3456-7890']
  ],
  'ì£¼ê°„ì„±ì ': [
    ['í™ê¸¸ë™', 'Aë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-01-W3', 45, 48, 42, 50, 47, 85, 90, 88, 92, 85, 78, 82, 95, 90],
    ['ê¹€ì² ìˆ˜', 'Aë°˜', 'ì„œìš¸ê³ ë“±í•™êµ', '2025-01-W3', 42, 45, 40, 48, 44, 80, 85, 82, 88, 80, 72, 78, 90, 85],
    ['ì´ì˜í¬', 'Bë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-01-W3', 48, 50, 46, 49, 50, 90, 95, 92, 96, 90, 85, 88, 98, 95]
  ],
  'ë‚´ì‹ ê¸°ì¶œì„±ì ': [
    // í™ê¸¸ë™ - ê³µí†µì‹œí—˜
    ['í™ê¸¸ë™', 'Aë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'ê³µí†µ', '3ì›” ëª¨ì˜ê³ ì‚¬', 18, 16, 20, 18, 14, 12, 98, 100],
    ['í™ê¸¸ë™', 'Aë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'ê³µí†µ', '4ì›” í•™ë ¥í‰ê°€', 17, 15, 19, 17, 13, 11, 92, 100],
    // í™ê¸¸ë™ - í•™êµë³„ ì‹œí—˜
    ['í™ê¸¸ë™', 'Aë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'í•™êµ', '1ì°¨ ì§€í•„ê³ ì‚¬', 19, 17, 18, 19, 15, 14, 102, 110],
    ['í™ê¸¸ë™', 'Aë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'í•™êµ', '2ì°¨ ì§€í•„ê³ ì‚¬', 18, 16, 19, 18, 14, 13, 98, 110],
    // ê¹€ì² ìˆ˜ - ê³µí†µì‹œí—˜
    ['ê¹€ì² ìˆ˜', 'Aë°˜', 'ì„œìš¸ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'ê³µí†µ', '3ì›” ëª¨ì˜ê³ ì‚¬', 16, 14, 18, 16, 12, 10, 86, 100],
    ['ê¹€ì² ìˆ˜', 'Aë°˜', 'ì„œìš¸ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'ê³µí†µ', '4ì›” í•™ë ¥í‰ê°€', 15, 13, 17, 15, 11, 9, 80, 100],
    // ê¹€ì² ìˆ˜ - í•™êµë³„ ì‹œí—˜
    ['ê¹€ì² ìˆ˜', 'Aë°˜', 'ì„œìš¸ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'í•™êµ', '1ì°¨ ì§€í•„ê³ ì‚¬', 17, 15, 16, 17, 13, 12, 90, 110],
    ['ê¹€ì² ìˆ˜', 'Aë°˜', 'ì„œìš¸ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'í•™êµ', '2ì°¨ ì§€í•„ê³ ì‚¬', 16, 14, 17, 16, 12, 11, 86, 110],
    // ì´ì˜í¬ - ê³µí†µì‹œí—˜
    ['ì´ì˜í¬', 'Bë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'ê³µí†µ', '3ì›” ëª¨ì˜ê³ ì‚¬', 19, 18, 20, 19, 16, 14, 106, 100],
    ['ì´ì˜í¬', 'Bë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'ê³µí†µ', '4ì›” í•™ë ¥í‰ê°€', 18, 17, 19, 18, 15, 13, 100, 100],
    // ì´ì˜í¬ - í•™êµë³„ ì‹œí—˜
    ['ì´ì˜í¬', 'Bë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'í•™êµ', '1ì°¨ ì§€í•„ê³ ì‚¬', 20, 18, 19, 20, 16, 15, 108, 110],
    ['ì´ì˜í¬', 'Bë°˜', 'í•œêµ­ê³ ë“±í•™êµ', '2025-1í•™ê¸°', 'í•™êµ', '2ì°¨ ì§€í•„ê³ ì‚¬', 19, 17, 20, 19, 15, 14, 104, 110]
  ],
  'ì„¤ì •': [
    ['ë…í•´ë‹¨ì–´1_ë§Œì ', '50'],
    ['ë…í•´ë‹¨ì–´2_ë§Œì ', '50'],
    ['ë¬¸ë²•ì´ë¡ _ë§Œì ', '100'],
    ['ë¬¸ë²•ì‘ìš©_ë§Œì ', '100'],
    ['ëª¨ì˜ê³ ì‚¬_ë§Œì ', '100'],
    ['ë‚´ì‹ ê¸°ì¶œ_ë§Œì ', '100'],
    ['ìˆ™ì œ_ë§Œì ', '100'],
    ['ë…í•´ë‹¨ì–´1_ì´ë¦„', 'Week1'],
    ['ë…í•´ë‹¨ì–´2_ì´ë¦„', 'Week2-1'],
    ['ë…í•´ë‹¨ì–´3_ì´ë¦„', 'Week2-2'],
    ['ë…í•´ë‹¨ì–´4_ì´ë¦„', 'Week3-1'],
    ['ë…í•´ë‹¨ì–´5_ì´ë¦„', 'Week3-2'],
    ['ëª¨ì˜ê³ ì‚¬_ë¹„ìœ¨', '0.25'],
    ['ë¬¸ë²•ì‘ìš©_ë¹„ìœ¨', '0.20'],
    ['ë¬¸ë²•ì´ë¡ _ë¹„ìœ¨', '0.15'],
    ['ë…í•´ë‹¨ì–´_ë¹„ìœ¨', '0.25'],
    ['ë‚´ì‹ ê¸°ì¶œ_ë¹„ìœ¨', '0.10'],
    ['ìˆ™ì œ_ë¹„ìœ¨', '0.05']
  ]
};

async function getAuthClient() {
  if (!GOOGLE_SERVICE_ACCOUNT_EMAIL || !GOOGLE_PRIVATE_KEY) {
    throw new Error('Google Sheets API ì¸ì¦ ì •ë³´ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
  }

  const auth = new google.auth.GoogleAuth({
    credentials: {
      client_email: GOOGLE_SERVICE_ACCOUNT_EMAIL,
      private_key: GOOGLE_PRIVATE_KEY,
    },
    scopes: ['https://www.googleapis.com/auth/spreadsheets'],
  });

  return auth;
}

async function getSheetsClient() {
  const auth = await getAuthClient();
  return google.sheets({ version: 'v4', auth });
}

async function setupSheet(sheets, sheetName, headers, sampleData) {
  console.log(`\nğŸ“‹ ${sheetName} ì‹œíŠ¸ ì„¤ì • ì¤‘...`);

  try {
    // í—¤ë” ì¶”ê°€
    await sheets.spreadsheets.values.update({
      spreadsheetId: SPREADSHEET_ID,
      range: `${sheetName}!A1`,
      valueInputOption: 'RAW',
      requestBody: {
        values: [headers]
      }
    });
    console.log(`  âœ… í—¤ë” ì¶”ê°€ ì™„ë£Œ: ${headers.join(', ')}`);

    // ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
    if (sampleData && sampleData.length > 0) {
      await sheets.spreadsheets.values.update({
        spreadsheetId: SPREADSHEET_ID,
        range: `${sheetName}!A2`,
        valueInputOption: 'RAW',
        requestBody: {
          values: sampleData
        }
      });
      console.log(`  âœ… ìƒ˜í”Œ ë°ì´í„° ${sampleData.length}ê°œ ì¶”ê°€ ì™„ë£Œ`);
    }

  } catch (error) {
    console.error(`  âŒ ${sheetName} ì‹œíŠ¸ ì„¤ì • ì‹¤íŒ¨:`, error.message);
  }
}

async function main() {
  console.log('ğŸš€ Google ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì„¤ì • ì‹œì‘...\n');
  console.log(`ğŸ“Š ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID: ${SPREADSHEET_ID}`);
  console.log(`ğŸ“§ ì„œë¹„ìŠ¤ ê³„ì •: ${GOOGLE_SERVICE_ACCOUNT_EMAIL}`);

  try {
    const sheets = await getSheetsClient();

    // ì—°ê²° í…ŒìŠ¤íŠ¸
    const response = await sheets.spreadsheets.get({
      spreadsheetId: SPREADSHEET_ID,
    });
    console.log(`\nâœ… ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ê²° ì„±ê³µ: "${response.data.properties.title}"`);

    // ê° ì‹œíŠ¸ ì„¤ì •
    for (const [sheetName, headers] of Object.entries(SHEET_HEADERS)) {
      await setupSheet(sheets, sheetName, headers, SAMPLE_DATA[sheetName]);
    }

    console.log('\nğŸ‰ ëª¨ë“  ì‹œíŠ¸ ì„¤ì • ì™„ë£Œ!');
    console.log('\nğŸ“ ë‹¤ìŒ ë‹¨ê³„:');
    console.log('   1. https://report-card-one.vercel.app ì ‘ì†');
    console.log('   2. ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸');
    console.log('   3. ì‹¤ì œ ë°ì´í„°ë¡œ êµì²´');

  } catch (error) {
    console.error('\nâŒ ì˜¤ë¥˜ ë°œìƒ:', error.message);
    if (error.message.includes('permission')) {
      console.log('\nğŸ’¡ í•´ê²° ë°©ë²•:');
      console.log('   ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ ì„œë¹„ìŠ¤ ê³„ì •ê³¼ ê³µìœ í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
      console.log(`   ì„œë¹„ìŠ¤ ê³„ì • ì´ë©”ì¼: ${GOOGLE_SERVICE_ACCOUNT_EMAIL}`);
    }
  }
}

main();
